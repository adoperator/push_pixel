var KEYS={BET:"lastBet",SHOW:"lastShow",CLICK:"lastClick"},idb=function(c){"use strict";function e(c){return new Promise(function(d,a){c.oncomplete=c.onsuccess=function(){return d(c.result)},c.onabort=c.onerror=function(){return a(c.error)}})}function d(d,g){var f=indexedDB.open(d);f.onupgradeneeded=function(){var a=f.result;if(!a.objectStoreNames.contains(g)){var b=a.createObjectStore(g);return b.add(0,KEYS.BET),b.add(0,KEYS.SHOW),b.add(0,KEYS.CLICK),b}};var h=e(f);return function(c,a){return h.then(function(b){return a(b.transaction(g,c).objectStore(g))})}}function g(){return a||(a=d("resources","push")),a}var a;return c.createStore=d,c.get=function(a){return g("readonly",function(b){return e(b.get(a))})},c.promisifyRequest=e,c.set=function(c,d){return g("readwrite",function(a){return a.put(d,c),e(a.transaction)})},c}({}),DEFAULT_CONFIG={frequencyOfNotifications:28800,intervalOfNotifications:{from:8,to:22},frequencyOfBet:1200,defaultOptionsPush:{title:"",body:""}};self.addEventListener("push",function(a){a.waitUntil(onPush_(a))}),self.addEventListener("notificationclick",function(a){var b=a.notification.data.click_action||"/";a.notification.close(),a.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then(function(a){for(var c,d=0;d<a.length;d++)if(c=a[d],c.url===b&&"focus"in c)return c.focus();return idb.set(KEYS.CLICK,Date.now()),clients.openWindow(b)}))});function defaultPush_(){return self.registration.showNotification(DEFAULT_CONFIG.defaultOptionsPush.title,DEFAULT_CONFIG.defaultOptionsPush)}async function canShowNotification_(){var a=await fetch("https://cdn.jsdelivr.net/gh/adoperator/push_pixel@latest/dist/config.json");a.ok&&(DEFAULT_CONFIG=await a.json());var b=DEFAULT_CONFIG,c=await idb.get(KEYS.SHOW),d=await idb.get(KEYS.BET);if(Date.now()-d<1e3*b.frequencyOfBet)return!1;var e=new Date(Date.now()),f=e.getHours(),g=f>=b.intervalOfNotifications.from&&f<=b.intervalOfNotifications.to,h=Date.now()-c>1e3*b.frequencyOfNotifications;return g&&h}async function onPush_(a){var b=await canShowNotification_();if(!b)return defaultPush_();var c=a.data.json(),d=c.notification||{};if(!d.body)return defaultPush_();var e=navigator.userAgent,f=d.body.replace("%user_agent%",e),g=await fetch(f);if(!g.ok)return defaultPush_();var h=await g.json();return h.length?void(idb.set(KEYS.BET,Date.now()),await sendPush_(h)):defaultPush_()}async function sendPush_(a){a.forEach(async function(a){await self.registration.showNotification(a.title,{body:a.text,icon:a.icon_url,image:a.image_url,data:{click_action:a.click_url}}),idb.set(KEYS.SHOW,Date.now())})}